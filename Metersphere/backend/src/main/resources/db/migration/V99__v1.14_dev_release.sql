-- 增加P4标签
UPDATE metersphere.custom_field
SET
 options = '[{\"value\":\"P0\", \"text\":\"P0\", \"system\": true},{\"value\":\"P1\", \"text\":\"P1\",\"system\": true},{\"value\":\"P2\", \"text\":\"P2\", \"system\": true},{\"value\":\"P3\", \"text\":\"P3\", \"system\": true},{\"value\":\"P4\", \"text\":\"P4\", \"system\": true}]'
WHERE
	(
		id = '4619cc23-9d1d-11eb-b418-0242ac120002'
	);


-- 测试计划增加版本
ALTER table test_plan add version_id varchar(50) NOT NULL COMMENT '版本' DEFAULT '无';

-- 测试用例缺陷关联表：增加所属测试计划
ALTER table test_case_issues add plan_id varchar(50) NOT NULL COMMENT '所属测试计划' DEFAULT '无';

-- 关闭同步缺陷定时任务
UPDATE SCHEDULE SET ENABLE = '0' WHERE (project_id='system' and workspace_id = 'system' and resource_id = 'system' and name = 'ISSUE_SYNC');

-- 测试计划列表展示字段，增加‘影响版本’；（检查user_header表type='test_plan_list'的数据）
UPDATE system_header SET type='test_plan_list', props='[{\"id\":\"name\",\"label\":\"名称\"},{\"id\":\"versionId\",\"label\":\"影响版本\"},{\"id\":\"userName\",\"label\":\"负责人\"},{\"id\":\"createUser\",\"label\":\"创建人\"},{\"id\":\"status\",\"label\":\"当前状态\"},{\"id\":\"stage\",\"label\":\"测试阶段\"},{\"id\":\"testRate\",\"label\":\"测试进度\"},{\"id\":\"projectName\",\"label\":\"所属项目\"},{\"id\":\"plannedStartTime\",\"label\":\"计划开始\"},{\"id\":\"plannedEndTime\",\"label\":\"计划结束\"},{\"id\":\"actualStartTime\",\"label\":\"实际开始\"},{\"id\":\"actualEndTime\",\"label\":\"实际结束\"},{\"id\":\"tags\",\"label\":\"标签\"},{\"id\":\"executionTimes\",\"label\":\"执行次数\"},{\"id\":\"passRate\",\"label\":\"通过率\"}]' WHERE (type='test_plan_list');


-- 用例模板删除‘用例状态’字段
delete from custom_field where id = '45f2de57-9d1d-11eb-b418-0242ac120002' and name='用例状态' and scene ='TEST_CASE';
delete from custom_field_template where id = 'f448e8d2-fad1-4c23-a013-3f3ba282bb81' and field_id='45f2de57-9d1d-11eb-b418-0242ac120002' and template_id ='b395d8fe-2ad6-4de7-81d3-2006b53a97c8';
-- 如需恢复执行
-- INSERT INTO custom_field (id, name, scene, type, remark, options, system, global, workspace_id, create_time, update_time, create_user) VALUES ('45f2de57-9d1d-11eb-b418-0242ac120002', '用例状态', 'TEST_CASE', 'select', '', '[{\"value\":\"Prepare\", \"text\":\"test_track.case.status_prepare\", \"system\": true},{\"value\":\"Underway\", \"text\":\"test_track.case.status_running\",\"system\": true},{\"value\":\"Completed\", \"text\":\"test_track.case.status_finished\", \"system\": true}]', '1', '1', 'global', '1632281538000', '1632281538000', NULL);
-- INSERT INTO custom_field_template (id, field_id, template_id, scene, required, order, default_value, custom_data, key) VALUES ('f448e8d2-fad1-4c23-a013-3f3ba282bb81', '45f2de57-9d1d-11eb-b418-0242ac120002', 'b395d8fe-2ad6-4de7-81d3-2006b53a97c8', 'TEST_CASE', '1', NULL, '\"Prepare\"', NULL, 'C');

-- 关联测试表增加项目id
ALTER table test_case_test add project_id varchar(50) NOT NULL COMMENT '项目id';

-- 自定义字段 2022-07-14
update metersphere.custom_field set options = '[{"text":"致命","value":"致命"},{"text":"严重","value":"严重"},{"text":"一般","value":"一般"},{"text":"小缺陷","value":"小缺陷"},{"text":"优化","value":"优化"}]' where id ='d392af07-fdfe-4475-a459-87d59f0b1626' and name='严重程度' and scene ='ISSUE';
update metersphere.custom_field set options = '[{"text":"处理中","value":"processing"},{"text":"待投产","value":"putIntoProduction"},{"text":"已关闭","value":"closed"},{"text":"已修改","value":"modified"},{"text":"被拒绝","value":"refused"},{"text":"修复失败","value":"repairFailure"},{"text":"已分配","value":"assigned"},{"text":"延期修改","value":"extendedModified"},{"text":"NORUN","value":"NORUN"},{"text":"FAILED","value":"FAILED"},{"text":"PASSED","value":"PASSED"},{"text":"BLOCKED","value":"BLOCKED"},{"text":"N/A","value":"N/A"},{"text":"新建","value":"new"},{"text":"已解决","value":"resolved"},{"text":"已删除","value":"delete"}]' where id ='beb57501-19c8-4ca3-8dfb-2cef7c0ea087' and name='状态' and scene ='ISSUE';
INSERT INTO metersphere.custom_field (id, name, scene, type, remark, options, `system`, global, workspace_id, create_time, update_time, create_user) VALUES ('d9e0c756-785f-43a6-aa0e-d458090238c4', '报告人', 'ISSUE', 'member', '', '[]', 1, 1, 'global', 1657763787101, 1657763787101, 'admin');
INSERT INTO metersphere.custom_field (id, name, scene, type, remark, options, `system`, global, workspace_id, create_time, update_time, create_user) VALUES ('b5571c4d-7951-45ff-a9e0-18a262df438e', '是否修复引入缺陷', 'ISSUE', 'select', '', '[{"text":"是","value":"是"},{"text":"否","value":"否"}]', 1, 1, 'global', 1657763724601, 1657763724601, 'admin');
INSERT INTO metersphere.custom_field (id, name, scene, type, remark, options, `system`, global, workspace_id, create_time, update_time, create_user) VALUES ('5036a59d-a545-495f-a25a-3cbfa736326e', '设计类缺陷类型', 'ISSUE', 'select', '', '[{"text":"非设计缺陷","value":"非设计缺陷"},{"text":"设计与需求不符","value":"设计与需求不符"},{"text":"设计考虑不全","value":"设计考虑不全"},{"text":"设计逻辑错误","value":"设计逻辑错误"},{"text":"设计文档缺失","value":"设计文档缺失"},{"text":"设计优化","value":"设计优化"}]', 1, 1, 'global', 1657763682583, 1657763682583, 'admin');
INSERT INTO metersphere.custom_field (id, name, scene, type, remark, options, `system`, global, workspace_id, create_time, update_time, create_user) VALUES ('83e3065c-c15d-4d31-b980-7f1d1630707b', '需求缺陷类型', 'ISSUE', 'select', '', '[{"text":"非需求缺陷","value":"非需求缺陷"},{"text":"需求缺失","value":"需求缺失"},{"text":"需求优化","value":"需求优化"},{"text":"需求模板规范不符","value":"需求模板规范不符"},{"text":"需求逻辑不符","value":"需求逻辑不符"}]', 1, 1, 'global', 1657763507428, 1657763526500, 'admin');
INSERT INTO metersphere.custom_field (id, name, scene, type, remark, options, `system`, global, workspace_id, create_time, update_time, create_user) VALUES ('acf1e219-73ea-49d0-9fb6-929836f8a459', '优先级', 'ISSUE', 'select', '', '[{"text":"Highest","value":"Highest"},{"text":"High","value":"High"},{"text":"Medium","value":"Medium"},{"text":"Low","value":"Low"},{"text":"Lowest","value":"Lowest"}]', 1, 1, 'global', 1657763402579, 1657763402579, 'admin');
INSERT INTO metersphere.custom_field (id, name, scene, type, remark, options, `system`, global, workspace_id, create_time, update_time, create_user) VALUES ('707b00b2-f01e-4fec-b948-de6554359337', '测试类型', 'ISSUE', 'select', '', '[{"text":"手工","value":"手工"},{"text":"自动化","value":"自动化"}]', 1, 1, 'global', 1657763266258, 1657763266258, 'admin');
INSERT INTO metersphere.custom_field (id, name, scene, type, remark, options, `system`, global, workspace_id, create_time, update_time, create_user) VALUES ('67dd1296-9b51-49cf-9d17-81b6908c1206', '提交次数', 'ISSUE', 'select', '', '[{"text":"1次","value":"1次"},{"text":"2次","value":"2次"},{"text":"3次","value":"3次"},{"text":"3次以上","value":"3次以上"}]', 1, 1, 'global', 1657763221907, 1657763221907, 'admin');
INSERT INTO metersphere.custom_field (id, name, scene, type, remark, options, `system`, global, workspace_id, create_time, update_time, create_user) VALUES ('702dd16d-5b3b-4803-89a5-2a3f0f5a0963', '缺陷类型', 'ISSUE', 'select', '', '[{"text":"需求","value":"需求"},{"text":"设计","value":"设计"},{"text":"功能不符","value":"功能不符"},{"text":"界面","value":"界面"},{"text":"性能","value":"性能"},{"text":"容错性","value":"容错性"},{"text":"安全性","value":"安全性"},{"text":"文档","value":"文档"},{"text":"其他","value":"其他"},{"text":"体验","value":"体验"},{"text":"手工","value":"手工"},{"text":"页面","value":"页面"},{"text":"测试案例","value":"测试案例"},{"text":"用例文件夹","value":"用例文件夹"}]', 1, 1, 'global', 1657763154608, 1657763154608, 'admin');
INSERT INTO metersphere.custom_field (id, name, scene, type, remark, options, `system`, global, workspace_id, create_time, update_time, create_user) VALUES ('45525061-259d-4c36-87a2-c289efdc3432', '引入阶段', 'ISSUE', 'select', '', '[{"text":"需求阶段","value":"需求阶段"},{"text":"设计阶段","value":"设计阶段"},{"text":"编码阶段","value":"编码阶段"},{"text":"配置管理","value":"配置管理"},{"text":"实施阶段","value":"实施阶段"}]', 1, 1, 'global', 1657762978967, 1657762978967, 'admin');
INSERT INTO metersphere.custom_field (id, name, scene, type, remark, options, `system`, global, workspace_id, create_time, update_time, create_user) VALUES ('d668b1e8-ecaf-4646-99dd-1689da650b0c', '发现阶段', 'ISSUE', 'select', '', '[{"text":"需求阶段","value":"需求阶段"},{"text":"设计阶段","value":"设计阶段"},{"text":"编码阶段","value":"编码阶段"},{"text":"测试阶段","value":"测试阶段"},{"text":"验收阶段","value":"验收阶段"}]', 1, 1, 'global', 1657762859446, 1657762859446, 'admin');
INSERT INTO metersphere.custom_field (id, name, scene, type, remark, options, `system`, global, workspace_id, create_time, update_time, create_user) VALUES ('08400a68-bed4-4e1d-a63a-41539a558caf', '修复的版本', 'ISSUE', 'multipleSelect', '', '[{"text":"无","value":"无"}]', 1, 1, 'global', 1657762745304, 1657762745304, 'admin');
INSERT INTO metersphere.custom_field (id, name, scene, type, remark, options, `system`, global, workspace_id, create_time, update_time, create_user) VALUES ('3b18452d-2a5e-4f16-b20b-31e549866835', '模块', 'ISSUE', 'multipleSelect', '', '[{"text":"无","value":"无"}]', 1, 1, 'global', 1657762393012, 1657762451722, 'admin');
INSERT INTO metersphere.custom_field (id, name, scene, type, remark, options, `system`, global, workspace_id, create_time, update_time, create_user) VALUES ('decdd87d-3234-4f66-b44d-05544605700e', '影响版本', 'ISSUE', 'multipleSelect', '', '[{"text":"无","value":"无"}]', 1, 1, 'global', 1657762445542, 1657762445542, 'admin');
INSERT INTO metersphere.custom_field (id, name, scene, type, remark, options, `system`, global, workspace_id, create_time, update_time, create_user) VALUES ('db3b002e-dc84-458f-b5f9-91b2ef828fed', '缺陷归属', 'ISSUE', 'select', '', '[{"text":"项目缺陷","value":"项目缺陷"},{"text":"产品缺陷","value":"产品缺陷"}]', 1, 1, 'global', 1657706231603, 1657762302722, 'admin');
INSERT INTO metersphere.custom_field (id, name, scene, type, remark, options, `system`, global, workspace_id, create_time, update_time, create_user) VALUES ('536ee579-337f-4221-b16d-230412ab358d', '是否单元测试逃逸', 'ISSUE', 'select', '', '[{"text":"否","value":"no"},{"text":"是","value":"yes"}]', 1, 1, 'global', 1635090092018, 1657706145536, 'admin');
INSERT INTO metersphere.custom_field (id, name, scene, type, remark, options, `system`, global, workspace_id, create_time, update_time, create_user) VALUES ('6b9992d8-0ee1-4116-8f66-d69122fb2db0', '缺陷引入人', 'ISSUE', 'member', '', '[]', 1, 1, 'global', 1635090123287, 1657705875785, 'admin');
INSERT INTO metersphere.custom_field (id, name, scene, type, remark, options, `system`, global, workspace_id, create_time, update_time, create_user) VALUES ('ab46669d-aac0-4739-8bc1-3147926c5778', '经办人', 'ISSUE', 'member', '', '[]', 1, 1, 'global', 1635160717249, 1657705868450, 'admin');

-- 缺陷模板字段及默认值 2022-07-14
update metersphere.custom_field_template set default_value = '"一般"' where id='3d6a182f-cea7-452e-828d-4550edada409';
update metersphere.custom_field_template set default_value = '"assigned"' where id='d5908553-1b29-4868-9001-e938822b92ef';
INSERT INTO metersphere.custom_field_template (id, field_id, template_id, scene, required, `order`, default_value, custom_data, `key`) VALUES ('773a1f99-bf8a-475e-b061-d32dd53036a0', 'd9e0c756-785f-43a6-aa0e-d458090238c4', '5d7c87d2-f405-4ec1-9a3d-71b514cdfda3', 'ISSUE', 1, null, null, null, 'C');
INSERT INTO metersphere.custom_field_template (id, field_id, template_id, scene, required, `order`, default_value, custom_data, `key`) VALUES ('2d0ee3f4-cefa-4b17-8e9e-b87f475f2814', 'ab46669d-aac0-4739-8bc1-3147926c5778', '5d7c87d2-f405-4ec1-9a3d-71b514cdfda3', 'ISSUE', 1, null, null, null, 'D');
INSERT INTO metersphere.custom_field_template (id, field_id, template_id, scene, required, `order`, default_value, custom_data, `key`) VALUES ('a0096c09-7e8f-4dbb-93b6-f3ea45213df6', 'db3b002e-dc84-458f-b5f9-91b2ef828fed', '5d7c87d2-f405-4ec1-9a3d-71b514cdfda3', 'ISSUE', 1, null, '"产品缺陷"', null, 'E');
INSERT INTO metersphere.custom_field_template (id, field_id, template_id, scene, required, `order`, default_value, custom_data, `key`) VALUES ('202855a6-781e-4c01-b4a5-0a333ccd19de', '3b18452d-2a5e-4f16-b20b-31e549866835', '5d7c87d2-f405-4ec1-9a3d-71b514cdfda3', 'ISSUE', 1, null, '[]', null, 'F');
INSERT INTO metersphere.custom_field_template (id, field_id, template_id, scene, required, `order`, default_value, custom_data, `key`) VALUES ('0e289001-8877-403a-a401-dc136f540846', 'decdd87d-3234-4f66-b44d-05544605700e', '5d7c87d2-f405-4ec1-9a3d-71b514cdfda3', 'ISSUE', 1, null, '[]', null, 'G');
INSERT INTO metersphere.custom_field_template (id, field_id, template_id, scene, required, `order`, default_value, custom_data, `key`) VALUES ('9c363734-aa98-45a3-a2fb-3b1df9cfc56e', '6b9992d8-0ee1-4116-8f66-d69122fb2db0', '5d7c87d2-f405-4ec1-9a3d-71b514cdfda3', 'ISSUE', 1, null, null, null, 'H');
INSERT INTO metersphere.custom_field_template (id, field_id, template_id, scene, required, `order`, default_value, custom_data, `key`) VALUES ('df53c9fa-1a73-40bd-af6c-01c97ecafaec', '536ee579-337f-4221-b16d-230412ab358d', '5d7c87d2-f405-4ec1-9a3d-71b514cdfda3', 'ISSUE', 1, null, '"no"', null, 'I');
INSERT INTO metersphere.custom_field_template (id, field_id, template_id, scene, required, `order`, default_value, custom_data, `key`) VALUES ('155bd723-c9e6-468b-bf34-8fd5c27e37c1', '08400a68-bed4-4e1d-a63a-41539a558caf', '5d7c87d2-f405-4ec1-9a3d-71b514cdfda3', 'ISSUE', 0, null, '[]', null, 'J');
INSERT INTO metersphere.custom_field_template (id, field_id, template_id, scene, required, `order`, default_value, custom_data, `key`) VALUES ('22fe9d12-8817-42b3-aeba-28102398de8f', 'd668b1e8-ecaf-4646-99dd-1689da650b0c', '5d7c87d2-f405-4ec1-9a3d-71b514cdfda3', 'ISSUE', 0, null, '"测试阶段"', null, 'K');
INSERT INTO metersphere.custom_field_template (id, field_id, template_id, scene, required, `order`, default_value, custom_data, `key`) VALUES ('c8f60fe0-ea03-4c42-bb47-62cd4c87d0fa', '45525061-259d-4c36-87a2-c289efdc3432', '5d7c87d2-f405-4ec1-9a3d-71b514cdfda3', 'ISSUE', 0, null, '"编码阶段"', null, 'L');
INSERT INTO metersphere.custom_field_template (id, field_id, template_id, scene, required, `order`, default_value, custom_data, `key`) VALUES ('0487d1f9-64cd-4b24-8726-3bca198cd7d5', '702dd16d-5b3b-4803-89a5-2a3f0f5a0963', '5d7c87d2-f405-4ec1-9a3d-71b514cdfda3', 'ISSUE', 1, null, '"功能不符"', null, 'M');
INSERT INTO metersphere.custom_field_template (id, field_id, template_id, scene, required, `order`, default_value, custom_data, `key`) VALUES ('6eb9b186-95a3-49b2-bcb2-4e52a55abf13', '67dd1296-9b51-49cf-9d17-81b6908c1206', '5d7c87d2-f405-4ec1-9a3d-71b514cdfda3', 'ISSUE', 0, null, '"1次"', null, 'N');
INSERT INTO metersphere.custom_field_template (id, field_id, template_id, scene, required, `order`, default_value, custom_data, `key`) VALUES ('9b2d3c66-beba-4459-a83e-f1ad62f6ed62', '707b00b2-f01e-4fec-b948-de6554359337', '5d7c87d2-f405-4ec1-9a3d-71b514cdfda3', 'ISSUE', 0, null, '"手工"', null, 'O');
INSERT INTO metersphere.custom_field_template (id, field_id, template_id, scene, required, `order`, default_value, custom_data, `key`) VALUES ('b536f031-3dc6-4f0f-966e-23f915609308', 'acf1e219-73ea-49d0-9fb6-929836f8a459', '5d7c87d2-f405-4ec1-9a3d-71b514cdfda3', 'ISSUE', 0, null, '"Medium"', null, 'P');
INSERT INTO metersphere.custom_field_template (id, field_id, template_id, scene, required, `order`, default_value, custom_data, `key`) VALUES ('3706b79e-61b3-43ef-8999-32144141778e', '83e3065c-c15d-4d31-b980-7f1d1630707b', '5d7c87d2-f405-4ec1-9a3d-71b514cdfda3', 'ISSUE', 1, null, '"非需求缺陷"', null, 'Q');
INSERT INTO metersphere.custom_field_template (id, field_id, template_id, scene, required, `order`, default_value, custom_data, `key`) VALUES ('c081f169-9b5e-4bbf-a3f7-d46912b1e6d3', '5036a59d-a545-495f-a25a-3cbfa736326e', '5d7c87d2-f405-4ec1-9a3d-71b514cdfda3', 'ISSUE', 1, null, '"非设计缺陷"', null, 'R');
INSERT INTO metersphere.custom_field_template (id, field_id, template_id, scene, required, `order`, default_value, custom_data, `key`) VALUES ('98a7f4cc-8c76-46bd-9855-21ba955ddb85', 'b5571c4d-7951-45ff-a9e0-18a262df438e', '5d7c87d2-f405-4ec1-9a3d-71b514cdfda3', 'ISSUE', 0, null, '"否"', null, 'S');

-- 测试用例缺陷关联表增加字段
ALTER table test_case_issues add platform varchar(50) NULL COMMENT '平台';